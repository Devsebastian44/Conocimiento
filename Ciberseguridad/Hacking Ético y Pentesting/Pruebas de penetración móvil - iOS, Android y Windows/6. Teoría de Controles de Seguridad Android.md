# Arquitectura de Seguridad Android

### Android Security Model

**Descripción**: Modelo de seguridad basado en Linux con mejoras específicas **Componentes Principales**:

- **Kernel Linux**: Base del sistema con hardening adicional
- **Hardware Abstraction Layer (HAL)**: Interfaz entre hardware y software
- **Android Runtime (ART)**: Entorno de ejecución para aplicaciones
- **Framework Layer**: APIs y servicios del sistema
- **Application Layer**: Aplicaciones de usuario

### Process Isolation

**Descripción**: Aislamiento de procesos para prevenir interferencias **Características**:

- Cada aplicación ejecuta en su propio proceso
- UID único para cada aplicación
- Sandboxing a nivel de kernel
- Comunicación controlada entre procesos

# Modelo de Permisos

## Permission Model

Descripción: Sistema de permisos granulares para acceso a recursos 

Tipos de Permisos:

- **Normal**: Permisos de bajo riesgo concedidos automáticamente
- **Dangerous**: Permisos de alto riesgo que requieren autorización del usuario
- **Signature**: Permisos solo para aplicaciones firmadas con el mismo certificado
- **System**: Permisos solo para aplicaciones del sistema

## Runtime Permissions (Android 6.0+)

Descripción: Solicitud de permisos en tiempo de ejecución 

Características:

- Solicitud cuando se necesita el permiso
- Concesión granular por parte del usuario
- Revocación de permisos en cualquier momento
- Graceful degradation cuando se niegan permisos

Implementación:

```java
// Verificar permiso
if (ContextCompat.checkSelfPermission(this, 
    Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED) {
    
    // Solicitar permiso
    ActivityCompat.requestPermissions(this,
        new String[]{Manifest.permission.CAMERA},
        CAMERA_PERMISSION_REQUEST_CODE);
}
```

# Application Components Security

## Activities

Descripción: Componentes de interfaz de usuario 

Controles de Seguridad:

- Declaración de visibilidad (exported)
- Intent filters para comunicación
- Validación de datos de entrada
- Protección contra task hijacking

## Services

Descripción: Componentes para operaciones en background 

Controles de Seguridad:

- Restricción de acceso mediante permisos
- Validación de Intent callers
- Protección de datos sensibles
- Limitación de capacidades

## Content Providers

Descripción: Componentes para compartir datos entre aplicaciones 

Controles de Seguridad:

- Permisos de lectura/escritura
- URI permissions
- Validación de consultas SQL
- Protección contra SQL injection

## Broadcast Receivers

Descripción: Componentes para recibir mensajes del sistema 

Controles de Seguridad:

- Permisos para envío/recepción
- Filtros de Intent específicos
- Validación de remitentes
- Protección contra broadcast injection

# Protección de Datos

## Storage Security

Descripción: Protección de datos almacenados 

Métodos de Almacenamiento:

- **Internal Storage**: Privado para la aplicación
- **External Storage**: Accesible por otras aplicaciones
- **Shared Preferences**: Pares clave-valor
- **SQLite Database**: Base de datos local

Mejores Prácticas:

```java
// Almacenamiento interno privado
FileOutputStream fos = openFileOutput("datos.txt", Context.MODE_PRIVATE);

// Cifrado de datos sensibles
String encryptedData = encrypt(sensitiveData);
SharedPreferences.Editor editor = getSharedPreferences("prefs", MODE_PRIVATE).edit();
editor.putString("encrypted_data", encryptedData);
editor.apply();
```

## Android Keystore

Descripción: Sistema de almacenamiento seguro para claves criptográficas 

Características:

- Almacenamiento en hardware seguro (cuando disponible)
- Claves no extractables
- Operaciones criptográficas en hardware
- Autenticación biométrica

Uso:

```java
// Generar clave en Keystore
KeyGenerator keyGenerator = KeyGenerator.getInstance("AES", "AndroidKeyStore");
KeyGenParameterSpec keyGenParameterSpec = new KeyGenParameterSpec.Builder(
    "MiClave", KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT)
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .build();
keyGenerator.init(keyGenParameterSpec);
keyGenerator.generateKey();
```

# Network Security

## Network Security Config

Descripción: Configuración de seguridad para comunicaciones de red 

Características:

- Configuración declarativa
- Certificate pinning
- Restricción de conexiones cleartext
- Configuración por dominio

Ejemplo de Configuración:

```xml
<network-security-config>
    <domain-config cleartextTrafficPermitted="false">
        <domain includeSubdomains="true">secure.example.com</domain>
        <pin-set expiration="2024-01-01">
            <pin digest="SHA-256">7HIpactkIAq2Y49orFOOQKurWxmmSFZhBCoQYcRhJ3Y=</pin>
        </pin-set>
    </domain-config>
</network-security-config>
```

# Device Security Features

## Device Encryption

Descripción: Cifrado completo del dispositivo

Características:

- Cifrado basado en AES
- Claves derivadas de credenciales de usuario
- Protección de datos en reposo
- Mandatory desde Android 6.0

## Verified Boot

Descripción: Verificación de integridad del sistema 

Características:

- Verificación criptográfica del kernel
- Detección de modificaciones
- Rollback protection
- Warning mode para desarrolladores

### Hardware Security Module (HSM)

Descripción: Módulo de seguridad hardware

Funcionalidades:

- Almacenamiento seguro de claves
- Operaciones criptográficas
- Atestación de hardware
- Protección contra ataques físicos

# Security Updates

## Android Security Patches

Descripción: Actualizaciones mensuales de seguridad **

Características:

- Parches críticos de seguridad
- Distribución por fabricantes
- Versionado específico
- Transparencia en security bulletins

## Google Play Protect

Descripción: Servicio de protección continua 

Funcionalidades:

- Análisis de aplicaciones instaladas
- Detección de malware
- Verificación de integridad
- Acciones correctivas automáticas

# Modern Security Features

## Biometric Authentication

Descripción: Autenticación mediante biometría.

Tipos:

- Fingerprint
- Face unlock
- Voice recognition
- Iris scanning

## Android for Work

Descripción: Separación de perfiles personal y laboral 

Características:

- Contenedor separado para datos corporativos
- Políticas de administración
- Cifrado independiente
- Wipe selectivo
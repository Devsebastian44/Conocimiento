SMB es un protocolo de red para compartir archivos, impresoras y otros recursos entre nodos de una red.

# Información Básica sobre SMB

Puertos SMB:

- Puerto 139: NetBIOS Session Service
- Puerto 445: Microsoft-DS (Direct SMB)

Versiones SMB:

- SMBv1: Vulnerable, depreciado
- SMBv2: Mejorado, más seguro
- SMBv3: Actual, con encriptación

## Enumeración con Nmap

Escaneo básico SMB:

```bash
nmap -p 139,445 192.168.1.1
```

Scripts NSE para SMB:

```bash
# Información básica SMB
nmap -p 445 --script smb-protocols 192.168.1.1

# Enumeración de shares
nmap -p 445 --script smb-enum-shares 192.168.1.1

# Enumeración de usuarios
nmap -p 445 --script smb-enum-users 192.168.1.1

# Información del sistema
nmap -p 445 --script smb-os-discovery 192.168.1.1

# Vulnerabilidades SMB
nmap -p 445 --script smb-vuln-* 192.168.1.1
```

## Herramientas Adicionales para SMB

enum4linux:

```bash
# Enumeración completa
enum4linux -a 192.168.1.1

# Solo usuarios
enum4linux -U 192.168.1.1

# Solo shares
enum4linux -S 192.168.1.1
```

smbclient:

```bash
# Listar shares
smbclient -L //192.168.1.1

# Conectar a share específico
smbclient //192.168.1.1/share

# Con credenciales
smbclient //192.168.1.1/share -U username
```

rpcclient:

```bash
# Conectar con null session
rpcclient -U "" 192.168.1.1

# Comandos útiles dentro de rpcclient:
# enumdomusers - Enumerar usuarios del dominio
# enumdomgroups - Enumerar grupos del dominio
# queryuser <RID> - Información de usuario específico
```

## Técnicas de Enumeración SMB

Null Session Attack:

- Explotación de configuración incorrecta
- Permite acceso anónimo a información
- Común en sistemas Windows antiguos

Enumeración de Shares:

```bash
# Identificar shares disponibles
smbclient -N -L //192.168.1.1

# Acceder a share sin autenticación
smbclient -N //192.168.1.1/share_name
```

Enumeración de Usuarios:

```bash
# Con enum4linux
enum4linux -U 192.168.1.1

# Con rpcclient
rpcclient -U "" -N 192.168.1.1
> enumdomusers
> queryuser 500
```
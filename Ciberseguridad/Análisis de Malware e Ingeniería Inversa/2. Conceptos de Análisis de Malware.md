# Escenario de Infección

## Cadena de Infección Típica

1. **Vector de Entrada**: Email, USB, descarga web
2. **Ejecución Inicial**: Usuario ejecuta archivo o exploit automático
3. **Persistencia**: Malware se establece en el sistema
4. **Escalada de Privilegios**: Obtención de permisos administrativos
5. **Reconocimiento**: Mapeo del sistema y red
6. **Lateral Movement**: Propagación a otros sistemas
7. **Exfiltración**: Robo de datos
8. **Impacto**: Daño, cifrado, destrucción

### Ejemplo de Escenario Completo

```
1. Usuario recibe email con adjunto "Factura.pdf.exe"
2. Ejecuta el archivo creyendo que es un PDF
3. Malware se copia a %APPDATA%\Microsoft\Windows\
4. Crea entrada en el registro para persistencia
5. Contacta servidor C&C para recibir comandos
6. Instala keylogger para capturar credenciales
7. Busca archivos financieros en el sistema
8. Cifra documentos importantes
9. Muestra mensaje de rescate
```

## Análisis de Malware y sus Tipos

### 1. **Análisis Estático**

- **Definición**: Análisis sin ejecutar el malware
- **Ventajas**:
    - Seguro (no hay ejecución)
    - Rápido para análisis inicial
    - Identificación de strings, imports, estructura
- **Desventajas**:
    - Limitado por obfuscación
    - No muestra comportamiento dinámico
    - Puede ser engañado por packers

**Técnicas de Análisis Estático**:

- **Hashing**: MD5, SHA1, SHA256 para identificación
- **Análisis de strings**: Búsqueda de URLs, IPs, comandos
- **Análisis PE**: Estructura del ejecutable
- **Análisis de imports**: Funciones de API utilizadas
- **Análisis hexadecimal**: Búsqueda de patrones

### 2. **Análisis Dinámico**

- **Definición**: Análisis ejecutando el malware en entorno controlado
- **Ventajas**:
    - Muestra comportamiento real
    - Revela funcionalidad oculta
    - Identifica comunicaciones de red
- **Desventajas**:
    - Riesgoso si no está contenido
    - Puede ser detectado por malware
    - Requiere entorno especializado

**Técnicas de Análisis Dinámico**:

- **Monitoreo de procesos**: Creación, terminación, inyección
- **Análisis de red**: Conexiones, DNS, tráfico
- **Monitoreo de archivos**: Creación, modificación, eliminación
- **Análisis de registro**: Modificaciones en Windows Registry
- **Análisis de memoria**: Volcado y análisis de memoria RAM

### 3. **Análisis Híbrido**

- **Definición**: Combinación de análisis estático y dinámico
- **Ventajas**: Análisis más completo y preciso
- **Aplicación**: Análisis profesional de malware

## Reglas Generales, Firmas y Ofuscación

### Reglas Generales del Análisis

1. **Aislamiento**: Siempre usar entorno aislado
2. **Documentación**: Registrar todos los hallazgos
3. **Verificación**: Confirmar resultados con múltiples herramientas
4. **Cautela**: Asumir que el malware puede ser evasivo
5. **Actualización**: Mantener herramientas actualizadas

### Firmas (Signatures)

- **Definición**: Patrones únicos que identifican malware específico
- **Tipos**:
    - **Firmas de hash**: Identificación exacta del archivo
    - **Firmas de bytes**: Secuencias específicas de bytes
    - **Firmas de comportamiento**: Patrones de actividad
    - **Firmas de red**: Patrones de comunicación

**Ejemplo de Firma YARA**:

```yara
rule Ejemplo_Malware {
    meta:
        description = "Detecta malware específico"
        author = "Analista"
        date = "2024-01-01"
    
    strings:
        $s1 = "malicious_string" ascii
        $s2 = { 90 90 90 90 } // NOP padding
        $s3 = /http:\/\/[a-z]+\.evil\.com/
    
    condition:
        ($s1 and $s2) or $s3
}
```

### Técnicas de Ofuscación

1. **Packing**: Compresión y cifrado del código
2. **Metamorfismo**: Cambio de código manteniendo funcionalidad
3. **Polimorfismo**: Cifrado con clave variable
4. **Ofuscación de strings**: Cifrado de cadenas importantes
5. **Anti-debugging**: Técnicas para evitar análisis
6. **VM/Sandbox detection**: Detección de entornos de análisis

**Ejemplo de String Ofuscado**:

```python
# Original: "http://malware.com/payload.exe"
# Ofuscado: 
encrypted = [0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f]
key = 0x13
original = ''.join(chr(c ^ key) for c in encrypted)
```